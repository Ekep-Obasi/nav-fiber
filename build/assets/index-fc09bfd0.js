import{g as Me,a as $e,s as ee,_,a8 as Nt,r as w,b as Re,j as s,d as Le,c as J,e as Ae,u as ut,aL as _t,b7 as xe,b8 as De,a6 as Je,b9 as zt,ba as It,$ as Bt,f as Y,F as O,h as B,D as pt,b1 as Ft,T as q,B as ft,aZ as Te,W as Oe,b2 as Vt,bb as Yt,bc as Gt,bd as Ut,V as M,be as ne,bf as se,ao as et,bg as me,bh as ge,bi as tt,bj as V,bk as Wt,aq as Ht,bl as ot,bm as nt,bn as st,bo as rt,bp as Zt,al as Kt,bq as Xt}from"./index-8f0fe879.js";import{B as qt}from"./index-d20a2c64.js";import{q as Qt,r as Jt,i as eo,C as ht,I as to,B as Ne,c as oo,b as no,F as so,s as ro}from"./react-toastify.esm-1cafe5b3.js";import{e as ao,A as mt}from"./index-8bbb501b.js";import{T as gt}from"./index-b2d69e89.js";import{c as at,d as io}from"./index-113a1c23.js";import{D as co,P as lo}from"./PlusIcon-43a942d8.js";import{p as uo,c as po}from"./index-30d16895.js";import{u as fo}from"./Popover-10650de7.js";import{u as ho}from"./index-76eed258.js";import{L as mo,m as go,u as Z,b as ye,T as bo,C as xo}from"./constant-d1c4d70a.js";import{f as yo,P as wo,L as jo}from"./constants-228f9707.js";import{A as vo}from"./AddContentIcon-fd0c16d2.js";import"./useSlotProps-24d3a778.js";import"./Popper-714c1c0d.js";import"./index.esm-eaea2432.js";import"./InfoIcon-c57ee9a7.js";import"./generateCategoricalChart-ac707456.js";import"./NoFilterResultIcon-4a27b020.js";import"./index-1afba01d.js";import"./index-7da72b8b.js";import"./CheckIcon-4784bd23.js";function ko(t){return Me("PrivateSwitchBase",t)}$e("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Eo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],Po=t=>{const{classes:n,checked:i,disabled:e,edge:c}=t,l={root:["root",i&&"checked",e&&"disabled",c&&`edge${J(c)}`],input:["input"]};return Ae(l,ko,n)},Co=ee(Qt)(({ownerState:t})=>_({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),So=ee("input",{shouldForwardProp:Nt})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),To=w.forwardRef(function(n,i){const{autoFocus:e,checked:c,checkedIcon:l,className:p,defaultChecked:r,disabled:a,disableFocusRipple:m=!1,edge:u=!1,icon:f,id:h,inputProps:v,inputRef:P,name:g,onBlur:b,onChange:C,onFocus:R,readOnly:A,required:T=!1,tabIndex:k,type:D,value:z}=n,E=Re(n,Eo),[L,j]=ho({controlled:c,default:!!r,name:"SwitchBase",state:"checked"}),$=fo(),we=F=>{R&&R(F),$&&$.onFocus&&$.onFocus(F)},te=F=>{b&&b(F),$&&$.onBlur&&$.onBlur(F)},ae=F=>{if(F.nativeEvent.defaultPrevented)return;const ie=F.target.checked;j(ie),C&&C(F,ie)};let K=a;$&&typeof K>"u"&&(K=$.disabled);const pe=D==="checkbox"||D==="radio",oe=_({},n,{checked:L,disabled:K,disableFocusRipple:m,edge:u}),G=Po(oe);return s.jsxs(Co,_({component:"span",className:Le(G.root,p),centerRipple:!0,focusRipple:!m,disabled:K,tabIndex:null,role:void 0,onFocus:we,onBlur:te,ownerState:oe,ref:i},E,{children:[s.jsx(So,_({autoFocus:e,checked:c,defaultChecked:r,className:G.input,disabled:K,id:pe?h:void 0,name:g,onChange:ae,readOnly:A,ref:P,required:T,ownerState:oe,tabIndex:k,type:D},D==="checkbox"&&z===void 0?{}:{value:z},v)),L?l:f]}))}),Oo=To,Mo=w.createContext(),it=Mo;function $o(t){return Me("MuiGrid",t)}const Ro=[0,1,2,3,4,5,6,7,8,9,10],Lo=["column-reverse","column","row-reverse","row"],Ao=["nowrap","wrap-reverse","wrap"],de=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Do=$e("MuiGrid",["root","container","item","zeroMinWidth",...Ro.map(t=>`spacing-xs-${t}`),...Lo.map(t=>`direction-xs-${t}`),...Ao.map(t=>`wrap-xs-${t}`),...de.map(t=>`grid-xs-${t}`),...de.map(t=>`grid-sm-${t}`),...de.map(t=>`grid-md-${t}`),...de.map(t=>`grid-lg-${t}`),...de.map(t=>`grid-xl-${t}`)]),ue=Do,No=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function re(t){const n=parseFloat(t);return`${n}${String(t).replace(String(n),"")||"px"}`}function _o({theme:t,ownerState:n}){let i;return t.breakpoints.keys.reduce((e,c)=>{let l={};if(n[c]&&(i=n[c]),!i)return e;if(i===!0)l={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(i==="auto")l={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=xe({values:n.columns,breakpoints:t.breakpoints.values}),r=typeof p=="object"?p[c]:p;if(r==null)return e;const a=`${Math.round(i/r*1e8)/1e6}%`;let m={};if(n.container&&n.item&&n.columnSpacing!==0){const u=t.spacing(n.columnSpacing);if(u!=="0px"){const f=`calc(${a} + ${re(u)})`;m={flexBasis:f,maxWidth:f}}}l=_({flexBasis:a,flexGrow:0,maxWidth:a},m)}return t.breakpoints.values[c]===0?Object.assign(e,l):e[t.breakpoints.up(c)]=l,e},{})}function zo({theme:t,ownerState:n}){const i=xe({values:n.direction,breakpoints:t.breakpoints.values});return De({theme:t},i,e=>{const c={flexDirection:e};return e.indexOf("column")===0&&(c[`& > .${ue.item}`]={maxWidth:"none"}),c})}function bt({breakpoints:t,values:n}){let i="";Object.keys(n).forEach(c=>{i===""&&n[c]!==0&&(i=c)});const e=Object.keys(t).sort((c,l)=>t[c]-t[l]);return e.slice(0,e.indexOf(i))}function Io({theme:t,ownerState:n}){const{container:i,rowSpacing:e}=n;let c={};if(i&&e!==0){const l=xe({values:e,breakpoints:t.breakpoints.values});let p;typeof l=="object"&&(p=bt({breakpoints:t.breakpoints.values,values:l})),c=De({theme:t},l,(r,a)=>{var m;const u=t.spacing(r);return u!=="0px"?{marginTop:`-${re(u)}`,[`& > .${ue.item}`]:{paddingTop:re(u)}}:(m=p)!=null&&m.includes(a)?{}:{marginTop:0,[`& > .${ue.item}`]:{paddingTop:0}}})}return c}function Bo({theme:t,ownerState:n}){const{container:i,columnSpacing:e}=n;let c={};if(i&&e!==0){const l=xe({values:e,breakpoints:t.breakpoints.values});let p;typeof l=="object"&&(p=bt({breakpoints:t.breakpoints.values,values:l})),c=De({theme:t},l,(r,a)=>{var m;const u=t.spacing(r);return u!=="0px"?{width:`calc(100% + ${re(u)})`,marginLeft:`-${re(u)}`,[`& > .${ue.item}`]:{paddingLeft:re(u)}}:(m=p)!=null&&m.includes(a)?{}:{width:"100%",marginLeft:0,[`& > .${ue.item}`]:{paddingLeft:0}}})}return c}function Fo(t,n,i={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[i[`spacing-xs-${String(t)}`]];const e=[];return n.forEach(c=>{const l=t[c];Number(l)>0&&e.push(i[`spacing-${c}-${String(l)}`])}),e}const Vo=ee("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t,{container:e,direction:c,item:l,spacing:p,wrap:r,zeroMinWidth:a,breakpoints:m}=i;let u=[];e&&(u=Fo(p,m,n));const f=[];return m.forEach(h=>{const v=i[h];v&&f.push(n[`grid-${h}-${String(v)}`])}),[n.root,e&&n.container,l&&n.item,a&&n.zeroMinWidth,...u,c!=="row"&&n[`direction-xs-${String(c)}`],r!=="wrap"&&n[`wrap-xs-${String(r)}`],...f]}})(({ownerState:t})=>_({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),zo,Io,Bo,_o);function Yo(t,n){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const i=[];return n.forEach(e=>{const c=t[e];if(Number(c)>0){const l=`spacing-${e}-${String(c)}`;i.push(l)}}),i}const Go=t=>{const{classes:n,container:i,direction:e,item:c,spacing:l,wrap:p,zeroMinWidth:r,breakpoints:a}=t;let m=[];i&&(m=Yo(l,a));const u=[];a.forEach(h=>{const v=t[h];v&&u.push(`grid-${h}-${String(v)}`)});const f={root:["root",i&&"container",c&&"item",r&&"zeroMinWidth",...m,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...u]};return Ae(f,$o,n)},Uo=w.forwardRef(function(n,i){const e=ut({props:n,name:"MuiGrid"}),{breakpoints:c}=_t(),l=ao(e),{className:p,columns:r,columnSpacing:a,component:m="div",container:u=!1,direction:f="row",item:h=!1,rowSpacing:v,spacing:P=0,wrap:g="wrap",zeroMinWidth:b=!1}=l,C=Re(l,No),R=v||P,A=a||P,T=w.useContext(it),k=u?r||12:T,D={},z=_({},C);c.keys.forEach(j=>{C[j]!=null&&(D[j]=C[j],delete z[j])});const E=_({},l,{columns:k,container:u,direction:f,item:h,rowSpacing:R,columnSpacing:A,wrap:g,zeroMinWidth:b,spacing:P},D,{breakpoints:c.keys}),L=Go(E);return s.jsx(it.Provider,{value:k,children:s.jsx(Vo,_({ownerState:E,className:Le(L.root,p),as:m,ref:i},z))})}),Q=Uo;function Wo(t){return Me("MuiSwitch",t)}const Ho=$e("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),I=Ho,Zo=["className","color","edge","size","sx"],Ko=t=>{const{classes:n,edge:i,size:e,color:c,checked:l,disabled:p}=t,r={root:["root",i&&`edge${J(i)}`,`size${J(e)}`],switchBase:["switchBase",`color${J(c)}`,l&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},a=Ae(r,Wo,n);return _({},n,a)},Xo=ee("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.root,i.edge&&n[`edge${J(i.edge)}`],n[`size${J(i.size)}`]]}})(({ownerState:t})=>_({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${I.thumb}`]:{width:16,height:16},[`& .${I.switchBase}`]:{padding:4,[`&.${I.checked}`]:{transform:"translateX(16px)"}}})),qo=ee(Oo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.switchBase,{[`& .${I.input}`]:n.input},i.color!=="default"&&n[`color${J(i.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${I.checked}`]:{transform:"translateX(20px)"},[`&.${I.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${I.checked} + .${I.track}`]:{opacity:.5},[`&.${I.disabled} + .${I.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${I.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:n})=>_({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:Je(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${I.checked}`]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Je(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${I.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n.color}DisabledColor`]:`${t.palette.mode==="light"?zt(t.palette[n.color].main,.62):It(t.palette[n.color].main,.55)}`}},[`&.${I.checked} + .${I.track}`]:{backgroundColor:(t.vars||t).palette[n.color].main}})),Qo=ee("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,n)=>n.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),Jo=ee("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,n)=>n.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),en=w.forwardRef(function(n,i){const e=ut({props:n,name:"MuiSwitch"}),{className:c,color:l="primary",edge:p=!1,size:r="medium",sx:a}=e,m=Re(e,Zo),u=_({},e,{color:l,edge:p,size:r}),f=Ko(u),h=s.jsx(Jo,{className:f.thumb,ownerState:u});return s.jsxs(Xo,{className:Le(f.root,c),sx:a,ownerState:u,children:[s.jsx(qo,_({type:"checkbox",icon:h,checkedIcon:h,ref:i,ownerState:u},m,{classes:_({},f,{root:f.switchBase})})),s.jsx(Qo,{className:f.track,ownerState:u})]})}),tn=en,on={schemas:[],links:[]},xt=Bt(t=>({...on,setSchemas:n=>{t({schemas:n})},setSchemaLinks:n=>{t({links:n})}})),nn=/^[a-z0-9_]+$/,sn=({parentParam:t})=>{const[n,i]=w.useState(!1),[e,c]=w.useState([]),{fields:l,append:p,replace:r,remove:a}=Jt({name:"attributes"}),{setValue:m,watch:u}=eo();return w.useEffect(()=>{const f=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==io.value.toLowerCase()){i(!0);const v=await Ft(t);h=uo(v)}r(h),c(h)}catch(h){console.warn(h)}finally{i(!1)}};e.length===0&&f()},[t,m,r,e.length]),s.jsxs(s.Fragment,{children:[n?s.jsx(O,{align:"center",children:s.jsx(ht,{color:B.SECONDARY_BLUE,size:"30"})}):s.jsx(rn,{py:8,children:s.jsx(Q,{container:!0,spacing:2,children:l.map((f,h)=>{const v=u(`attributes[${h}].type`),P=u(`attributes[${h}].required`),g=f.isNew||!1;return s.jsxs(w.Fragment,{children:[s.jsx(Q,{item:!0,xs:5,children:s.jsx(gt,{autoComplete:"off",className:"text-input",disabled:!g,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...pt,pattern:{message:"Please avoid special characters, spaces and uppercase",value:nn}}})}),s.jsx(Q,{item:!0,xs:4,children:s.jsx(mt,{onSelect:b=>m(`attributes[${h}].type`,b==null?void 0:b.value),options:at,selectedValue:at.find(b=>b.value===v)})}),s.jsxs(Q,{item:!0,xs:3,children:[s.jsx(tn,{checked:P,disabled:!1,name:`attributes.${h}.required`,onChange:b=>m(`attributes[${h}].required`,b.target.checked),size:"small"}),s.jsx(to,{onClick:()=>a(h),children:s.jsx(co,{})})]})]},f.id)})})}),s.jsx(O,{align:"flex-start",py:12,children:s.jsx(Ne,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(lo,{}),variant:"contained",children:"Add Attribute"})})]})},rn=Y(O)`
  max-height: 260px;
  overflow: auto;
  width: calc(100% + 20px);
`,an=({parent:t})=>{const n=t;return s.jsxs(O,{children:[s.jsx(O,{direction:"row",mb:10,children:s.jsxs(Q,{container:!0,spacing:2,children:[s.jsx(Q,{item:!0,xs:5,children:s.jsx(Ce,{style:{marginRight:180},children:"Attributes"})}),s.jsx(Q,{item:!0,xs:4,children:s.jsx(Ce,{style:{marginRight:130},children:"Type"})}),s.jsx(Q,{item:!0,xs:3,children:s.jsx(Ce,{children:"Required"})})]})}),n&&s.jsx(sn,{parentParam:n},n)]})},Ce=Y(q)`
  font-size: 15px;
  color: gray;
`,cn={type:"",parent:""},ln=async(t,n=!1)=>{try{const{attributes:i,...e}=t,c={...e,attributes:po(i)};let l;if(n?l=await Oe.put("/schema",JSON.stringify(c),{}):l=await Oe.post("/schema",JSON.stringify({...c,node_key:"name"}),{}),l.status!=="success")throw new Error("error");return l==null?void 0:l.ref_id}catch(i){let e=Te;if(i.status===400){const c=await i.json();e=c.errorCode||(c==null?void 0:c.status)||Te}else i instanceof Error&&(e=i.message);throw new Error(e)}},dn=({onSchemaCreate:t,selectedSchema:n,onDelete:i,setSelectedSchemaId:e,setIsCreateNew:c})=>{const{close:l,visible:p}=ft("addType"),r=oo({mode:"onChange",defaultValues:n?{type:n.type,parent:n.parent}:cn}),{watch:a,setValue:m,reset:u}=r,[f,h]=w.useState(!1),[v,P]=w.useState(!1),[g,b]=w.useState(null);w.useEffect(()=>()=>{u()},[p,u]);const C=()=>{c(!1),e("")},R=E=>E.charAt(0).toUpperCase()+E.slice(1);w.useEffect(()=>{n||(async()=>{P(!0);try{const j=(await Vt()).schemas.filter($=>!$.is_deleted&&$.type).map($=>($==null?void 0:$.type)==="thing"?{label:"No Parent",value:$.type}:{label:R($.type),value:$.type});b(j)}catch(L){console.warn(L)}finally{P(!1)}})()},[n]);const A=a("parent"),T=()=>{l()},k=async()=>{if(n!=null&&n.type)try{await Oe.delete(`/schema/${n.ref_id}`),i(n.type),l()}catch(E){console.warn(E)}finally{c(!1)}},D=r.handleSubmit(async E=>{h(!1);try{const L=await ln({...E,...n?{ref_id:n==null?void 0:n.ref_id}:{}},!!n);t({type:E.type,parent:A||"",ref_id:(n==null?void 0:n.ref_id)||L||"new"}),T()}catch(L){if((L==null?void 0:L.status)===400){const j=await L.json();j.errorCode||j!=null&&j.status||Te}else L instanceof Error&&L.message}finally{h(!1),c(!1)}}),z=()=>g==null?void 0:g.find(E=>E.value===A);return s.jsxs(O,{children:[s.jsx(O,{direction:"row",justify:"flex-end",children:s.jsx(pn,{"data-testid":"close-sidebar-sub-view",onClick:C,children:s.jsx(no,{})})}),s.jsx(O,{children:s.jsx(so,{...r,children:s.jsxs("form",{id:"add-type-form",onSubmit:D,children:[s.jsx(O,{children:n?s.jsxs(s.Fragment,{children:[n.parent?s.jsx(O,{mb:12,children:s.jsxs(q,{kind:"headingBold",children:["Parent: ",n.parent]})}):null,s.jsx(O,{mb:12,children:s.jsxs(q,{kind:"headingBold",children:["Type: ",n.type]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(O,{mb:12,children:[s.jsx(O,{mb:12,children:s.jsx(q,{children:"Select Parent"})}),s.jsx(mt,{isLoading:v,onSelect:E=>m("parent",(E==null?void 0:E.value)||""),options:g,selectedValue:z()})]}),s.jsxs(O,{children:[s.jsx(O,{mb:12,children:s.jsx(q,{children:"Type name"})}),s.jsx(O,{mb:12,children:s.jsx(gt,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...pt},value:A})})]})]})}),s.jsx(an,{parent:n?n.type:A}),s.jsxs(O,{direction:"row",justify:"space-between",mt:20,children:[n?s.jsx(un,{color:"secondary",onClick:k,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(Ne,{color:"secondary",disabled:f,onClick:D,size:"large",startIcon:f?s.jsx(ht,{color:B.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},un=Y(Ne)`
  && {
    color: ${B.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${B.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,pn=Y(O)`
  font-size: 32px;
  color: ${B.white};
  cursor: pointer;
`;var fn=Object.defineProperty,hn=(t,n,i)=>n in t?fn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,x=(t,n,i)=>(hn(t,typeof n!="symbol"?n+"":n,i),i);const be=new Yt,ct=new Gt,mn=Math.cos(70*(Math.PI/180)),lt=(t,n)=>(t%n+n)%n;let gn=class extends Ut{constructor(n,i){super(),x(this,"object"),x(this,"domElement"),x(this,"enabled",!0),x(this,"target",new M),x(this,"minDistance",0),x(this,"maxDistance",1/0),x(this,"minZoom",0),x(this,"maxZoom",1/0),x(this,"minPolarAngle",0),x(this,"maxPolarAngle",Math.PI),x(this,"minAzimuthAngle",-1/0),x(this,"maxAzimuthAngle",1/0),x(this,"enableDamping",!1),x(this,"dampingFactor",.05),x(this,"enableZoom",!0),x(this,"zoomSpeed",1),x(this,"enableRotate",!0),x(this,"rotateSpeed",1),x(this,"enablePan",!0),x(this,"panSpeed",1),x(this,"screenSpacePanning",!0),x(this,"keyPanSpeed",7),x(this,"zoomToCursor",!1),x(this,"autoRotate",!1),x(this,"autoRotateSpeed",2),x(this,"reverseOrbit",!1),x(this,"reverseHorizontalOrbit",!1),x(this,"reverseVerticalOrbit",!1),x(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),x(this,"mouseButtons",{LEFT:ne.ROTATE,MIDDLE:ne.DOLLY,RIGHT:ne.PAN}),x(this,"touches",{ONE:se.ROTATE,TWO:se.DOLLY_PAN}),x(this,"target0"),x(this,"position0"),x(this,"zoom0"),x(this,"_domElementKeyEvents",null),x(this,"getPolarAngle"),x(this,"getAzimuthalAngle"),x(this,"setPolarAngle"),x(this,"setAzimuthalAngle"),x(this,"getDistance"),x(this,"listenToKeyEvents"),x(this,"stopListenToKeyEvents"),x(this,"saveState"),x(this,"reset"),x(this,"update"),x(this,"connect"),x(this,"dispose"),this.object=n,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=o=>{let d=lt(o,2*Math.PI),y=u.phi;y<0&&(y+=2*Math.PI),d<0&&(d+=2*Math.PI);let S=Math.abs(d-y);2*Math.PI-S<S&&(d<y?d+=2*Math.PI:y+=2*Math.PI),f.phi=d-y,e.update()},this.setAzimuthalAngle=o=>{let d=lt(o,2*Math.PI),y=u.theta;y<0&&(y+=2*Math.PI),d<0&&(d+=2*Math.PI);let S=Math.abs(d-y);2*Math.PI-S<S&&(d<y?d+=2*Math.PI:y+=2*Math.PI),f.theta=d-y,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=o=>{o.addEventListener("keydown",Ee),this._domElementKeyEvents=o},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ee),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(c),e.update(),a=r.NONE},this.update=(()=>{const o=new M,d=new M(0,1,0),y=new et().setFromUnitVectors(n.up,d),S=y.clone().invert(),N=new M,U=new et,X=2*Math.PI;return function(){const Qe=e.object.position;y.setFromUnitVectors(n.up,d),S.copy(y).invert(),o.copy(Qe).sub(e.target),o.applyQuaternion(y),u.setFromVector3(o),e.autoRotate&&a===r.NONE&&ae(we()),e.enableDamping?(u.theta+=f.theta*e.dampingFactor,u.phi+=f.phi*e.dampingFactor):(u.theta+=f.theta,u.phi+=f.phi);let W=e.minAzimuthAngle,H=e.maxAzimuthAngle;isFinite(W)&&isFinite(H)&&(W<-Math.PI?W+=X:W>Math.PI&&(W-=X),H<-Math.PI?H+=X:H>Math.PI&&(H-=X),W<=H?u.theta=Math.max(W,Math.min(H,u.theta)):u.theta=u.theta>(W+H)/2?Math.max(W,u.theta):Math.min(H,u.theta)),u.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,u.phi)),u.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(v,e.dampingFactor):e.target.add(v),e.zoomToCursor&&L||e.object.isOrthographicCamera?u.radius=je(u.radius):u.radius=je(u.radius*h),o.setFromSpherical(u),o.applyQuaternion(S),Qe.copy(e.target).add(o),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,v.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),v.set(0,0,0));let fe=!1;if(e.zoomToCursor&&L){let ce=null;if(e.object instanceof me&&e.object.isPerspectiveCamera){const le=o.length();ce=je(le*h);const he=le-ce;e.object.position.addScaledVector(z,he),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const le=new M(E.x,E.y,0);le.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0;const he=new M(E.x,E.y,0);he.unproject(e.object),e.object.position.sub(he).add(le),e.object.updateMatrixWorld(),ce=o.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ce!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ce).add(e.object.position):(be.origin.copy(e.object.position),be.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(be.direction))<mn?n.lookAt(e.target):(ct.setFromNormalAndCoplanarPoint(e.object.up,e.target),be.intersectPlane(ct,e.target))))}else e.object instanceof ge&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0);return h=1,L=!1,fe||N.distanceToSquared(e.object.position)>m||8*(1-U.dot(e.object.quaternion))>m?(e.dispatchEvent(c),N.copy(e.object.position),U.copy(e.object.quaternion),fe=!1,!0):!1}})(),this.connect=o=>{o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=o,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",Ke),e.domElement.addEventListener("pointerdown",We),e.domElement.addEventListener("pointercancel",He),e.domElement.addEventListener("wheel",Ze)},this.dispose=()=>{var o,d,y,S,N,U;(o=e.domElement)==null||o.removeEventListener("contextmenu",Ke),(d=e.domElement)==null||d.removeEventListener("pointerdown",We),(y=e.domElement)==null||y.removeEventListener("pointercancel",He),(S=e.domElement)==null||S.removeEventListener("wheel",Ze),(N=e.domElement)==null||N.ownerDocument.removeEventListener("pointermove",ve),(U=e.domElement)==null||U.ownerDocument.removeEventListener("pointerup",ke),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Ee)};const e=this,c={type:"change"},l={type:"start"},p={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=r.NONE;const m=1e-6,u=new tt,f=new tt;let h=1;const v=new M,P=new V,g=new V,b=new V,C=new V,R=new V,A=new V,T=new V,k=new V,D=new V,z=new M,E=new V;let L=!1;const j=[],$={};function we(){return 2*Math.PI/60/60*e.autoRotateSpeed}function te(){return Math.pow(.95,e.zoomSpeed)}function ae(o){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=o:f.theta-=o}function K(o){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=o:f.phi-=o}const pe=(()=>{const o=new M;return function(y,S){o.setFromMatrixColumn(S,0),o.multiplyScalar(-y),v.add(o)}})(),oe=(()=>{const o=new M;return function(y,S){e.screenSpacePanning===!0?o.setFromMatrixColumn(S,1):(o.setFromMatrixColumn(S,0),o.crossVectors(e.object.up,o)),o.multiplyScalar(y),v.add(o)}})(),G=(()=>{const o=new M;return function(y,S){const N=e.domElement;if(N&&e.object instanceof me&&e.object.isPerspectiveCamera){const U=e.object.position;o.copy(U).sub(e.target);let X=o.length();X*=Math.tan(e.object.fov/2*Math.PI/180),pe(2*y*X/N.clientHeight,e.object.matrix),oe(2*S*X/N.clientHeight,e.object.matrix)}else N&&e.object instanceof ge&&e.object.isOrthographicCamera?(pe(y*(e.object.right-e.object.left)/e.object.zoom/N.clientWidth,e.object.matrix),oe(S*(e.object.top-e.object.bottom)/e.object.zoom/N.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function F(o){e.object instanceof me&&e.object.isPerspectiveCamera||e.object instanceof ge&&e.object.isOrthographicCamera?h/=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ie(o){e.object instanceof me&&e.object.isPerspectiveCamera||e.object instanceof ge&&e.object.isOrthographicCamera?h*=o:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function _e(o){if(!e.zoomToCursor||!e.domElement)return;L=!0;const d=e.domElement.getBoundingClientRect(),y=o.clientX-d.left,S=o.clientY-d.top,N=d.width,U=d.height;E.x=y/N*2-1,E.y=-(S/U)*2+1,z.set(E.x,E.y,1).unproject(e.object).sub(e.object.position).normalize()}function je(o){return Math.max(e.minDistance,Math.min(e.maxDistance,o))}function ze(o){P.set(o.clientX,o.clientY)}function jt(o){_e(o),T.set(o.clientX,o.clientY)}function Ie(o){C.set(o.clientX,o.clientY)}function vt(o){g.set(o.clientX,o.clientY),b.subVectors(g,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(ae(2*Math.PI*b.x/d.clientHeight),K(2*Math.PI*b.y/d.clientHeight)),P.copy(g),e.update()}function kt(o){k.set(o.clientX,o.clientY),D.subVectors(k,T),D.y>0?F(te()):D.y<0&&ie(te()),T.copy(k),e.update()}function Et(o){R.set(o.clientX,o.clientY),A.subVectors(R,C).multiplyScalar(e.panSpeed),G(A.x,A.y),C.copy(R),e.update()}function Pt(o){_e(o),o.deltaY<0?ie(te()):o.deltaY>0&&F(te()),e.update()}function Ct(o){let d=!1;switch(o.code){case e.keys.UP:G(0,e.keyPanSpeed),d=!0;break;case e.keys.BOTTOM:G(0,-e.keyPanSpeed),d=!0;break;case e.keys.LEFT:G(e.keyPanSpeed,0),d=!0;break;case e.keys.RIGHT:G(-e.keyPanSpeed,0),d=!0;break}d&&(o.preventDefault(),e.update())}function Be(){if(j.length==1)P.set(j[0].pageX,j[0].pageY);else{const o=.5*(j[0].pageX+j[1].pageX),d=.5*(j[0].pageY+j[1].pageY);P.set(o,d)}}function Fe(){if(j.length==1)C.set(j[0].pageX,j[0].pageY);else{const o=.5*(j[0].pageX+j[1].pageX),d=.5*(j[0].pageY+j[1].pageY);C.set(o,d)}}function Ve(){const o=j[0].pageX-j[1].pageX,d=j[0].pageY-j[1].pageY,y=Math.sqrt(o*o+d*d);T.set(0,y)}function St(){e.enableZoom&&Ve(),e.enablePan&&Fe()}function Tt(){e.enableZoom&&Ve(),e.enableRotate&&Be()}function Ye(o){if(j.length==1)g.set(o.pageX,o.pageY);else{const y=Pe(o),S=.5*(o.pageX+y.x),N=.5*(o.pageY+y.y);g.set(S,N)}b.subVectors(g,P).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(ae(2*Math.PI*b.x/d.clientHeight),K(2*Math.PI*b.y/d.clientHeight)),P.copy(g)}function Ge(o){if(j.length==1)R.set(o.pageX,o.pageY);else{const d=Pe(o),y=.5*(o.pageX+d.x),S=.5*(o.pageY+d.y);R.set(y,S)}A.subVectors(R,C).multiplyScalar(e.panSpeed),G(A.x,A.y),C.copy(R)}function Ue(o){const d=Pe(o),y=o.pageX-d.x,S=o.pageY-d.y,N=Math.sqrt(y*y+S*S);k.set(0,N),D.set(0,Math.pow(k.y/T.y,e.zoomSpeed)),F(D.y),T.copy(k)}function Ot(o){e.enableZoom&&Ue(o),e.enablePan&&Ge(o)}function Mt(o){e.enableZoom&&Ue(o),e.enableRotate&&Ye(o)}function We(o){var d,y;e.enabled!==!1&&(j.length===0&&((d=e.domElement)==null||d.ownerDocument.addEventListener("pointermove",ve),(y=e.domElement)==null||y.ownerDocument.addEventListener("pointerup",ke)),Dt(o),o.pointerType==="touch"?Lt(o):$t(o))}function ve(o){e.enabled!==!1&&(o.pointerType==="touch"?At(o):Rt(o))}function ke(o){var d,y,S;Xe(o),j.length===0&&((d=e.domElement)==null||d.releasePointerCapture(o.pointerId),(y=e.domElement)==null||y.ownerDocument.removeEventListener("pointermove",ve),(S=e.domElement)==null||S.ownerDocument.removeEventListener("pointerup",ke)),e.dispatchEvent(p),a=r.NONE}function He(o){Xe(o)}function $t(o){let d;switch(o.button){case 0:d=e.mouseButtons.LEFT;break;case 1:d=e.mouseButtons.MIDDLE;break;case 2:d=e.mouseButtons.RIGHT;break;default:d=-1}switch(d){case ne.DOLLY:if(e.enableZoom===!1)return;jt(o),a=r.DOLLY;break;case ne.ROTATE:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enablePan===!1)return;Ie(o),a=r.PAN}else{if(e.enableRotate===!1)return;ze(o),a=r.ROTATE}break;case ne.PAN:if(o.ctrlKey||o.metaKey||o.shiftKey){if(e.enableRotate===!1)return;ze(o),a=r.ROTATE}else{if(e.enablePan===!1)return;Ie(o),a=r.PAN}break;default:a=r.NONE}a!==r.NONE&&e.dispatchEvent(l)}function Rt(o){if(e.enabled!==!1)switch(a){case r.ROTATE:if(e.enableRotate===!1)return;vt(o);break;case r.DOLLY:if(e.enableZoom===!1)return;kt(o);break;case r.PAN:if(e.enablePan===!1)return;Et(o);break}}function Ze(o){e.enabled===!1||e.enableZoom===!1||a!==r.NONE&&a!==r.ROTATE||(o.preventDefault(),e.dispatchEvent(l),Pt(o),e.dispatchEvent(p))}function Ee(o){e.enabled===!1||e.enablePan===!1||Ct(o)}function Lt(o){switch(qe(o),j.length){case 1:switch(e.touches.ONE){case se.ROTATE:if(e.enableRotate===!1)return;Be(),a=r.TOUCH_ROTATE;break;case se.PAN:if(e.enablePan===!1)return;Fe(),a=r.TOUCH_PAN;break;default:a=r.NONE}break;case 2:switch(e.touches.TWO){case se.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;St(),a=r.TOUCH_DOLLY_PAN;break;case se.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Tt(),a=r.TOUCH_DOLLY_ROTATE;break;default:a=r.NONE}break;default:a=r.NONE}a!==r.NONE&&e.dispatchEvent(l)}function At(o){switch(qe(o),a){case r.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ye(o),e.update();break;case r.TOUCH_PAN:if(e.enablePan===!1)return;Ge(o),e.update();break;case r.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ot(o),e.update();break;case r.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Mt(o),e.update();break;default:a=r.NONE}}function Ke(o){e.enabled!==!1&&o.preventDefault()}function Dt(o){j.push(o)}function Xe(o){delete $[o.pointerId];for(let d=0;d<j.length;d++)if(j[d].pointerId==o.pointerId){j.splice(d,1);return}}function qe(o){let d=$[o.pointerId];d===void 0&&(d=new V,$[o.pointerId]=d),d.set(o.pageX,o.pageY)}function Pe(o){const d=o.pointerId===j[0].pointerId?j[1]:j[0];return $[d.pointerId]}i!==void 0&&this.connect(i),this.update()}};const bn=new M,xn=w.forwardRef(function({start:n=[0,0,0],end:i=[0,0,0],mid:e,segments:c=20,...l},p){const r=w.useRef(null),[a]=w.useState(()=>new Wt(void 0,void 0,void 0)),m=w.useCallback((f,h,v,P=20)=>(f instanceof M?a.v0.copy(f):a.v0.set(...f),h instanceof M?a.v2.copy(h):a.v2.set(...h),v instanceof M?a.v1.copy(v):a.v1.copy(a.v0.clone().add(a.v2.clone().sub(a.v0)).add(bn.set(0,a.v0.y-a.v2.y,0))),a.getPoints(P)),[]);w.useLayoutEffect(()=>{r.current.setPoints=(f,h,v)=>{const P=m(f,h,v);r.current.geometry&&r.current.geometry.setPositions(P.map(g=>g.toArray()).flat())}},[]);const u=w.useMemo(()=>m(n,i,e,c),[n,i,e,c]);return w.createElement(mo,_({ref:go([r,p]),points:u},l))}),yn=w.forwardRef(({makeDefault:t,camera:n,regress:i,domElement:e,enableDamping:c=!0,onChange:l,onStart:p,onEnd:r,...a},m)=>{const u=Z(k=>k.invalidate),f=Z(k=>k.camera),h=Z(k=>k.gl),v=Z(k=>k.events),P=Z(k=>k.setEvents),g=Z(k=>k.set),b=Z(k=>k.get),C=Z(k=>k.performance),R=n||f,A=e||v.connected||h.domElement,T=w.useMemo(()=>new gn(R),[R]);return ye(()=>{T.enabled&&T.update()},-1),w.useEffect(()=>(T.connect(A),()=>void T.dispose()),[A,i,T,u]),w.useEffect(()=>{const k=E=>{u(),i&&C.regress(),l&&l(E)},D=E=>{p&&p(E)},z=E=>{r&&r(E)};return T.addEventListener("change",k),T.addEventListener("start",D),T.addEventListener("end",z),()=>{T.removeEventListener("start",D),T.removeEventListener("end",z),T.removeEventListener("change",k)}},[l,p,r,T,u,P]),w.useEffect(()=>{if(t){const k=b().controls;return g({controls:T}),()=>g({controls:k})}},[t,T]),w.createElement("primitive",_({ref:m,object:T,enableDamping:c},a))});function wn(t){const n=t+"Geometry";return w.forwardRef(({args:i,children:e,...c},l)=>w.createElement("mesh",_({ref:l},c),w.createElement(n,{attach:"geometry",args:i}),e))}const jn=wn("circle"),dt=t=>{const n=w.useRef();return w.useEffect(()=>{n.current=t}),n.current},yt=({links:t,nodes:n})=>{const i=w.useRef(null),e=w.useMemo(()=>{const c=[];return t.forEach((l,p)=>{const r=p%2===0?1:-1;if(!n)return;const a=n.find(b=>b.ref_id===l.source),m=n.find(b=>b.ref_id===l.target),u=new M((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0+.3,(a==null?void 0:a.z)||0),f=new M((m==null?void 0:m.x)||0,(m==null?void 0:m.y)||0-.4,(m==null?void 0:m.z)||0),h=new M(0,r*0,0),v=new M(0,r*0,0),P=u.clone().add(h),g=f.clone().add(v);c.push({start:P,end:g})}),c},[t,n]);return ye(()=>{i.current&&n&&i.current.children.forEach((c,l)=>{const p=t[l],r=n.find(b=>b.ref_id===p.source),a=n.find(b=>b.ref_id===p.target),m=new M((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0+.3,(r==null?void 0:r.z)||0),u=new M((a==null?void 0:a.x)||0,(a==null?void 0:a.y)||0-.4,(a==null?void 0:a.z)||0),f=new M(0,0*0,-1),h=new M(0,0*0,-1),v=m.clone().add(f),P=u.clone().add(h),g=c;g.setPoints&&g.setPoints(v,P)})}),s.jsx("group",{ref:i,children:e.map((c,l)=>s.jsx(w.Fragment,{children:s.jsx(xn,{userData:{ind:l},...c,color:"white",lineWidth:2})},l))})};yt.displayName="Lines";const vn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],kn=new Ht(2,2,2),wt=w.memo(({node:t,setSelectedNode:n,onSimulationUpdate:i,isSelected:e})=>{var f;const[c]=w.useState(kn),l=w.useRef(null),{size:p,camera:r}=Z(),a=ro(h=>{const{xy:[v,P],down:g,dragging:b,first:C,elapsedTime:R}=h;if(!(!b||C||R<100)&&g&&l.current){i();const A=(v-80)/window.innerWidth*p.width,T=(P-36)/window.innerHeight*p.height,z=new M(A/p.width*2-1,-T/p.height*2+1,0).unproject(r).multiply(new M(1,1,0)).clone();t.fx=z.x,t.fy=z.y}});w.useEffect(()=>function(){c.dispose()},[c]),ye(()=>{l.current&&l.current.position.set(t.x||0,t.y||0,0)});const m=vn[(f=t==null?void 0:t.children)==null?void 0:f.length]||"red",u=h=>{h.stopPropagation(),n()};return s.jsxs("mesh",{ref:l,...a(),position:new M(t.x,t.y,0),children:[s.jsx(jn,{args:[e?17:15,20,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:m})}),s.jsx(bo,{onClick:u,...yo,color:"#000",fontSize:4,children:t.type})]})});wt.displayName="Node";const En=({simulation:t,setSelectedSchemaId:n,selectedId:i})=>{const[e]=xt(l=>[l.schemas]),c=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((l,p)=>{const r=t.nodes()[p];return r?s.jsx(wt,{isSelected:r.ref_id===i,node:r,onSimulationUpdate:c,setSelectedNode:()=>n(r.ref_id)},r.ref_id):null})})},Pn=({schemasWithPositions:t,filteredLinks:n,setSelectedSchemaId:i,selectedSchemaId:e})=>{const[c,l]=w.useState(null),p=dt(t),r=dt(n);return w.useEffect(()=>{if(!t.length||!n.length)return;const a=structuredClone(t),m=structuredClone(n);if(c){p&&p.length!==t.length&&r&&r.length!==n.length&&(c.nodes(a).force("link",ot(m).id(f=>f.ref_id)).force("charge",nt()).force("center",st()).force("collide",rt(13)).alpha(.5).restart(),l({...c}));return}const u=Zt(a).force("link",ot(m).id(f=>f.ref_id)).force("charge",nt()).force("center",st()).force("collide",rt(18));l(u)},[t,c,n,p,r]),ye(()=>{}),c?s.jsxs(s.Fragment,{children:[s.jsx(yt,{links:n,nodes:c.nodes()}),s.jsx(En,{selectedId:e,setSelectedSchemaId:i,simulation:c})]}):null},Se=new Kt(1513243),Cn=({selectedSchemaId:t,links:n,schemasWithPositions:i,setSelectedSchemaId:e})=>s.jsxs(xo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[Se.r,Se.g,Se.b],attach:"background"}),s.jsx(wo,{position:"right-bottom"}),s.jsx(yn,{enableRotate:!1,enableZoom:!0}),s.jsx(jo,{}),s.jsx(Pn,{filteredLinks:n,schemasWithPositions:i,selectedSchemaId:t,setSelectedSchemaId:e})]}),Sn=({onCreateNew:t})=>s.jsxs(Tn,{children:[s.jsx(Mn,{children:"BLUEPRINT"}),s.jsxs(On,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx($n,{children:s.jsx(vo,{})}),s.jsx(q,{children:"Add Item"})]})]}),Tn=Y(O).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 64px;
  z-index: 31;
  transition: opacity 1s;
  background: ${B.BG2};
`,On=Y(O).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${B.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${q} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${B.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${B.primaryBlue};
    }

    ${q} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${B.white};
    background: ${B.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${B.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Mn=Y(O)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${B.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${B.white};
`,$n=Y(O)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,Rn=()=>{const[t,n]=w.useState(""),[i,e]=w.useState(!1),[c,l]=w.useState(!1),[p,r,a,m]=xt(g=>[g.schemas,g.links,g.setSchemas,g.setSchemaLinks]);w.useEffect(()=>{(async()=>{l(!0);try{const b=await Xt();a(b.schemas.filter(C=>C.ref_id&&!C.is_deleted&&C.ref_id)),m(b.edges),l(!1)}catch(b){console.error("Error fetching data:",b),l(!1)}})()},[a,m]);const u=g=>{if(p.some(C=>C.ref_id===g.ref_id))a(p.map(C=>C.ref_id===g.ref_id?{...g,children:[]}:C));else{a([...p,{...g,children:[]}]);const C=p.find(R=>g.parent===R.type);m([...r,{ref_id:`new-link-${r.length}`,edge_type:"CHILD_OF",source:g.ref_id||"new",target:(C==null?void 0:C.ref_id)||"new"}])}},f=g=>{a(p.filter(b=>b.type!==g))},h=p.map(g=>({...g,children:p.filter(b=>b.parent===g.type).map(b=>b.ref_id||"")})),v=r.filter(g=>g.edge_type==="CHILD_OF"&&h.some(b=>b.ref_id===g.source)&&h.some(b=>b.ref_id===g.target)),P=p.find(g=>g.ref_id===t)||null;return c?s.jsx(O,{children:"Loading"}):s.jsx(s.Fragment,{children:s.jsxs(O,{align:"stretch",direction:"row",grow:1,children:[s.jsx(O,{ml:-20,my:-20,children:s.jsx(Sn,{onCreateNew:()=>e(!0)})}),s.jsx(O,{children:P||i?s.jsx(An,{children:s.jsx(dn,{onDelete:f,onSchemaCreate:u,selectedSchema:P,setIsCreateNew:e,setSelectedSchemaId:n})}):null}),s.jsx(Ln,{direction:"row",grow:1,children:s.jsx(Dn,{children:s.jsx(Cn,{links:v,schemasWithPositions:h,selectedSchemaId:t,setSelectedSchemaId:n})})})]})})},Ln=Y(O)`
  flex: 1 1 100%;
  justify-content: center;
  position: relative;
`,An=Y(O)`
  width: 400px;
  background: ${B.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
`,Dn=Y(O)`
  flex: 1 1 100%;
`,Nn=()=>{const{close:t}=ft("blueprintGraph"),n=()=>{t()};return s.jsx(qt,{background:"black",id:"blueprintGraph",kind:"full",onClose:n,preventOutsideClose:!0,children:s.jsx(Rn,{})})},is=w.memo(Nn);export{is as BlueprintModal};
